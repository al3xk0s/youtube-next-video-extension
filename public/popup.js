(()=>{var T=(t,e)=>{let s=!1,o=0;for(let a of t)s||(s=e(a)),s&&o++;return o};var w="AIzaSyAv7X1m8T4JM8xVZ0hZZTjsSuvdQbaGmOM";var b=(...t)=>encodeURIComponent(t.join(","));var R=(()=>{let t=async(i,n=["snippet"])=>{let r=`https://youtube.googleapis.com/youtube/v3/videos?part=${b(...n)}&id=${b(...i)}&key=${w}`,c=await fetch(r);return JSON.parse(await c.text()).items},e=async(i,n=["snippet"])=>(await t([i],n))[0],s=async(i,n,r=50)=>{r=Math.min(50,Math.max(0,r));let c=n==null?"":`&pageToken=${n}`,l=`https://youtube.googleapis.com/youtube/v3/search?type=video&part=snippet&channelId=${i}&maxResults=${r}&order=date&key=${w}${c}`,d=await fetch(l);return JSON.parse(await d.text())};return{getChronologicVideoRange:(i,n,r=10,c)=>{if(r<=0)throw new Error(`Illegal argument range: ${r}`);let l,d=u=>u.id===n,$=u=>{let p=u.findIndex(d);return p>-1?u.slice(Math.max(0,p-r),Math.min(p+1+r,u.length)):[]},k=async(u=50)=>{let p=await s(i,l,u);l=p.nextPageToken;let V=p.items.map(g=>g.id.videoId);return(await t(V,["contentDetails"])).map(g=>({id:g.id.videoId,details:g.contentDetails})).filter(c)},A=async()=>{let u=[],p=()=>T(u,d)-1>=r,V=()=>l!=null,I=async()=>{let g=await k();return g.forEach(B=>u.push(B)),g};for(;;)if(await I(),!V()||p())return u};return(async()=>{let u=await A();throw new Error(`${u.length}: ${u.find(d)!=null}`)})()},getSearchVideoResponse:s,getVideoResponse:e,getVideosResponse:t,getChannelID:async i=>(await e(i,["snippet"])).snippet.channelId}})();var m=(t,e)=>{let s=e.split(t);if(s.length!==1)try{let o=Number.parseInt(s[0]);return Number.isNaN(o)?void 0:o}catch{return}},h=class t{constructor({days:e=0,hours:s=0,minutes:o=0,seconds:a=0,milliseconds:i=0}){this._days=e,this._hours=s,this._minutes=o,this._seconds=a,this._milliseconds=i}get days(){return this._days}get hours(){return this._hours}get minutes(){return this._minutes}get seconds(){return this._seconds}get milliseconds(){return this._milliseconds}get inDays(){return this.inHours/24}get inHours(){return this.inMinutes/60}get inMinutes(){return this.inSeconds/60}get inSeconds(){return this.inMilliseconds/1e3}get inMilliseconds(){return this._days*24*60*60*1e3+this._hours*60*60*1e3+this._minutes*60*1e3+this._seconds*1e3+this._milliseconds}isLess(e){return this.inMilliseconds<e.inMilliseconds}isMore(e){return this.inMilliseconds>e.inMilliseconds}isEqual(e){return this.inMilliseconds===e.inMilliseconds}isLessOrEqual(e){return this.isLess(e)||this.isEqual(e)}isMoreOrEqual(e){return this.isMore(e)||this.isEqual(e)}static{this.fromISO8601=e=>{let[s,o]=e.split("T");s=s.replace("P","");let a=m("Y",s)??0,i=m("M",s)??0,n=m("D",s)??0,r=m("H",o)??0,c=m("M",o)??0,l=m("S",o)??0;return new t({days:a*365+i*30+n,hours:r,minutes:c,seconds:l})}}};var M=new h({seconds:59}),f={get stringValues(){return Object.keys(f.values)},nextFilter(t){return this.stringValues[(this.stringValues.indexOf(t)+1)%this.stringValues.length]},values:{long:t=>h.fromISO8601(t.details.duration).isMore(M),shorts:t=>h.fromISO8601(t.details.duration).isLessOrEqual(M),all:t=>!0}};var _=async()=>{let[t]=await chrome.tabs.query({active:!0,lastFocusedWindow:!0});return t.url};var E=t=>t.includes("youtube.com"),F=t=>new URLSearchParams(new URL(t).search).get("v"),L=t=>F(t)!=null;var D={getValue:async()=>localStorage.getItem("filter")??"long",setValue:async t=>localStorage.setItem("filter",t)};var x=(()=>{let t=document.querySelector("#text-display"),e=n=>t.textContent=n.trim(),s=n=>{t.classList.remove(...Array.from(t.classList.entries()).map(([r,c])=>c).filter(r=>r.includes("display-text"))),t.classList.add(n)},o=n=>{e(n),s("display-text")};return{text:o,error:n=>{e(n),s("display-text-error")},initial:()=>o("Previous or next video")}})();var P=(t,e)=>{let s=t,o=[],a=l=>o.push(l),i=l=>o.forEach(d=>d(l)),n=l=>{s=l,i(s)},r=()=>s,c=()=>{o=[]};return e!=null&&a(e),{setValue:n,getValue:r,listen:a,dispose:c}};var y=(()=>{let t=document.querySelector("#video-type"),e=P(null,s=>{t.textContent=s});return{button:t,setFilterValue:e.setValue,listen:e.listen}})();var v=(()=>{let t=document.querySelector("#video-previous"),e=document.querySelector("#video-next");return{deactivate:()=>[t,e].forEach(a=>{a.classList.replace("btn","buttons__button-inactive"),a.disabled=!0}),activate:()=>[t,e].forEach(a=>{a.classList.replace("buttons__button-inactive","btn"),a.disabled=!1}),nextButton:e,previousButton:t}})();var O=t=>async(...e)=>{try{return await t(...e)}catch(s){x.error(s.message)}},q=O(({mode:t,filter:e="long"})=>{x.initial();let s=(i,n)=>{let r=n[t==="next"?0:n.length-1];if(r!==i)return r;let c=t==="next"?"It's last video":"It's first video";throw new Error(c)},o=(i,n)=>{let r=new URL(i);window.open(r.origin+r.pathname+`?v=${n}`,"_blank")};return(async()=>{let i=new URLSearchParams(window.location.search).get("url")??await _();if(!E(i)||!L(i))throw new Error("Is not youtube or video");let n,r;try{n=F(i),r=await R.getChannelID(n)}catch(d){throw new Error(d.toString())}let c=(await R.getChronologicVideoRange(r,n,1,f.values[e]??f.values.long)).map(d=>d.id);if(c.length===0)throw new Error("Video not found");let l=s(n,c);l!=null&&o(i,l)})()}),S=D,N=()=>{let t=async e=>{v.deactivate(),await q({mode:e,filter:await S.getValue()}),v.activate()};v.nextButton.addEventListener("click",()=>t("next")),v.previousButton.addEventListener("click",()=>t("previous"))},U=()=>{y.listen(e=>S.setValue(e));let t=async()=>{let e=await S.getValue(),s=f.nextFilter(e);return y.setFilterValue(s)};y.button.addEventListener("click",t)},C=async()=>{N(),U(),x.initial(),y.setFilterValue(await S.getValue())};C();})();
//# sourceMappingURL=popup.js.map
